{% extends 'index.html' %}

{% block title %}ServerLess{% endblock %}

{% block content %}
  <div
  x-data="{
    showForm: false,
    title: '',
    description: '',
    todos: JSON.parse(Utils.getItemFromLocal('todos') || '[]')
  }"
  x-init="$watch(
    'todos',
    (val) => Utils.setItemToLocal('todos', JSON.stringify(val))
  )"
  >
  <button x-on:click="showForm=true" x-show="!showForm">+Add Task</button>
  <div x-show="showForm">
    <form class="form-vertical"
    x-on:submit.prevent="
    todos = [].concat({
      'id': taskId(),
      'title': title,
      'description': description
    }, todos)
    title = ''
    description = ''
    showForm = false
    ">
      {% csrf_token %}
      <label for="title">Title</label>
      <input type="text" name="title" id="id_title" x-model="title">

      <label for="description">Description</label>
      <input
      type="text" 
      name="description"
      id="id_description"
      x-model="description">

      <button type="submit">Add Task</button>
      <button type="button" x-on:click="showForm=false">Cancel</button>
    </form>
  </div>
  <ul class="no-style margin-top-56">
    <h2>Tasks</h2>
    <template x-for="todo in todos">
      <li class="flex flex-align-center padding-8-0">
        <input
        type="checkbox"
        class="large-checkbox" 
        x-on:change="
        todos = todos.filter(t => t.id !== todo.id)
        " 
        value="">
        <div class="flex">
          <div>
            <div x-text="todo.title"></div>
            <div class="mute smaller" x-text="todo.description"></div>
          </div>
        </div>
      </li>
    </template>
  </ul>
</div>
<script>
  function taskId() {
    return (Math.random() * 100).toFixed(0);
  }
</script>
{% endblock %}
